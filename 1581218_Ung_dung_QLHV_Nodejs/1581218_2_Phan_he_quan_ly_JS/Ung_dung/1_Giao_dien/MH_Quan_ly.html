<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />    
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1"><title>
	Trường Đại Học An Ninh Nhân Dân
</title><link rel="stylesheet" href="./Template/bootstrap.css"><link rel="stylesheet" type="text/css" media="all" href="./Template/color-theme.css">
<link rel="stylesheet" type="text/css" media="all" href="./Template/webslidemenu.css">
<link rel="stylesheet" href="./Template/owl.carousel.css">
<link rel="stylesheet" href="./Template/owl.theme.css">
<link rel="stylesheet" href="./Template/owl.transitions.css">
<link rel="stylesheet" type="text/css" media="all" href="./Template/dttx.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css"
              integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
<script src="../2_Xu_ly/Xu_ly.js"></script>
</head>
<body style="font-family:Arial;height:auto;overflow-x:hidden">
 <form method="post" action="/" id="mainForm" enctype="multipart/form-data">
        <input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="CA0B0334">
      </div>
      
              <div class="wsmenucontainer clearfix">
                  <div id="khung_menu" class="wsmenucontent overlapblackbg menuclose"></div>
                  <div class="wsmenuexpandermain slideRight">
                      <a id="navToggle" class="animated-arrow slideLeft menuclose"><span></span></a>
                      <div class="search" style="background-color:orangered">                              
                              
                      </div>
                      <a href="MH_Quan_ly.html" class="smallogo"><img src="./Template/logo_m.jpg" height="34px" alt="" style="border-radius:2px;"></a>    
                  </div> 
                  <div class="header">
                      <div class="wrapper clearfix">
                      <div class="container hidden-xs" style="position:relative">
                        <div class="logo clearfix"><a href="MH_Quan_ly.html" title="Responsive Slide Menus"><img src="./Template/logo.jpg" alt="" height="70px"></a></div>                       
                        <div class="searchdestop" style="float:right">                                
                            <div class="btn  CHUC_NANG" data-toggle="collapse" style="float:right">
                                <div class="btn btn-outline-danger" onclick="Xu_ly_Dang_xuat()">Đăng xuất</div>
                            </div>
                        </div>
                    </div>
                      </div>
                    <div class="container-fluid" style="background-color:orangered">
                        <div class="container">
                          <nav class="wsmenu pm_buttoncolor blue-grdt slideLeft clearfix menuclose" style="background-color:orangered">
                              <ul class="mobile-sub wsmenu-list" style="background-color:orangered">
                                  <li><a data-id="trang-chu" class="thuc-don active" href="MH_Quan_ly.html"><i class="fa fa-home"></i><span class="hometext"></span></a></li>
                                  <li>                                    
                                        <div class="CUA_SO_CHUC_NANG" style="background-color:orangered;margin:10px">
                                                <div class="DANH_SACH_CHUC_NANG">
                                                    <div class="btn  CHUC_NANG">
                                                        <form method="post">
                                                            <input name="Th_Ma_so_Chuc_nang" type="hidden" value="" />
                                                            <input name="Th_Chuoi_Tra_cuu" style="height:30px"
                                                                   spellcheck="false" autocomplete="off" />
                                                        </form>
                                                    </div>                              
                                                </div>
                                            </div>
                                  </li>   
                                                                 
                              </ul>
                          </nav>
                          
                          </div>
                      </div>
                 </div>      
        <div class="wrapper content" id="noi_dung_chinh">                 
            <div class="container">                
                    <form action="javascript:Xu_ly_Dong_y()">
                            <div class="container-fluid">
                                <div id="form_dang_nhap" style="display: none">
                                    <div class="alert" style="height:10px">
                                         Đăng nhập Quản lý học viên
                                    </div>           
                                    <div class="alert" style="height:30px">
                                        <input  id="Th_Ten_dang_nhap_QL"  name="Th_Ten_dang_nhap" required="required"
                                               spellcheck="false" autocomplete="off" value=""/>
                                    </div>                                   
                                    <div class="alert" style="height:30px">
                                        <input  id="Th_Mat_khau_QL"  name="Th_Mat_khau" type="password" required="required"
                                               spellcheck="false" autocomplete="off" value="" />
                                    </div>
                                    <div class="alert" style="height:40px">
                                        <button id="Dong_y" class="btn btn-danger" type="submit" onclick="Xu_ly_Dong_y()">Đồng ý</button>                                        
                                    </div>
                                </div>
                                <div id='Th_Quan_ly'></div>
                                <div id='Th_Vai_tro' style="float:right"></div>
                                <div id='Th_Thong_bao'></div>
                                <div id='Th_Danh_sach_Lop'></div>
                                <div id='Th_Danh_sach_Sinh_vien'></div> 
                                <div id='Th_Sinh_vien'></div> 
                                <div id='Th_Chi_tiet_Sinh_vien'></div>    
                            </div>
                        </form>                                                                   
            </div>         
        </div>                                   
    </div>

                  <div style="clear:both"></div>  
                  <div class="footer">
                    <div class="container" style="min-height:30px">
                          <div class="col-sm-12">
                    <div style="padding-top:15px;font-size:13px;white-space: nowrap;overflow:hidden">
                      <div class="col-md-4 nhomcs">
                        <div class="tencs">
                          <b>Trường Đại Học An Ninh Nhân Dân</b></div>
                        <div>
                          <i class="fa fa-map-marker" aria-hidden="true" style="margin-right:5px; font-size:14px"></i>Km 18, xa lộ Hà Nội, P.Linh Trung, Q.Thủ Đức, TP.HCM</div>
                        <div>
                          <i class="fa fa-phone-square" aria-hidden="true" style="margin-right:5px; font-size:14px"></i> Điện thoại: 028.79797979</div>
                      </div>
                   
                      <div class="col-md-4 col-md-offset-4 nhomcs">
                        <div class="tencs">
                          <b>Kết nối với chúng tôi:</b></div>
                   
                        <div style="margin-top :12px;"><a href="https://www.facebook.com/AnNinhNhanDanTPHCM/" target="_blank"><i class="fa fa-facebook-square" aria-hidden="true" style="font-size:40px; color:#ffffff"></i></a></div>
                                  </div>
                    </div>
                  </div>
                        <div style="clear: both"></div>
                      </div>
                  </div>                 
                  
              </div>
 </form>         
          <script type="text/javascript" src="./Template/jquery.min.js.download"></script>
          <script type="text/javascript" src="./Template/bootstrap.js.download"></script>
          <script type="text/javascript" src="./Template/webslidemenu.js.download"></script>
          <script type="text/javascript" src="./Template/owl.carousel.js.download"></script>
          <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
            <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"
        integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
             
      <script type="text/javascript">
        var Danh_sach_Lop = Doc_Danh_sach_Lop()
        var Danh_sach_Sinh_vien = Doc_Danh_sach_Sinh_vien()
        var Danh_sach_Quan_ly = Doc_Danh_sach_Quan_ly()
        var Danh_sach_Giao_vien = Doc_Danh_sach_Giao_vien()
        var Quan_ly_Dang_nhap
        
        function GetURLParameter(sParam) {
            var sPageURL = window.location.search.substring(1);
            var sURLVariables = sPageURL.split('&');
            if (sURLVariables.length != 2){
                return 0;
            }
            for (var i = 0; i < sURLVariables.length; i++) {
                var sParameterName = sURLVariables[i].split('=');
                if (sParameterName[0] == sParam) {
                    return sParameterName[1];
                }
            } 
        }
        function Xu_ly_Dong_y(){             
                   var Ten_dang_nhap = GetURLParameter('Th_Ten_dang_nhap'); // Nhập liệu
                   var Mat_khau = GetURLParameter('Th_Mat_khau'); // Nhập liệu
                   var Quan_ly = {} // Biến Kq
                   var Hop_le = Danh_sach_Quan_ly.some(x => x.Ten_dang_nhap == Ten_dang_nhap
                            && x.Mat_khau == Mat_khau )
                   if (Hop_le) {
                    var Quan_ly = Danh_sach_Quan_ly.find(x => x.Ten_dang_nhap == Ten_dang_nhap
                          && x.Mat_khau == Mat_khau)
                    Quan_ly.Danh_sach_Dang_nhap.push(new Date())
                    document.getElementById("form_dang_nhap").innerHTML = "";
                    Th_Quan_ly.innerHTML=Tao_Chuoi_HTML_Quan_ly_Khi_Chao(Quan_ly)
                    Th_Thong_bao.innerHTML=`Anh/chị đang Quản lý 
                           ${Danh_sach_Lop.length} lớp 
                           với ${Danh_sach_Sinh_vien.length} sinh viên `
                    Th_Danh_sach_Lop.innerHTML=Tao_Chuoi_HTML_Danh_sach_Lop(
                        Danh_sach_Lop)
                    Th_Danh_sach_Sinh_vien.innerHTML=Tao_Chuoi_HTML_Danh_sach_Sinh_vien(
                        Danh_sach_Sinh_vien)

                    Ghi_Quan_ly(Quan_ly)
                    Quan_ly_Dang_nhap = Quan_ly

                    var Chuoi_HTML_Danh_sach_Nhom_nguoi_dung = `<select>`
                    var DS_Vai_tro = Quan_ly_Dang_nhap.Danh_sach_Nhom_Nguoi_dung
                    for (var i = 0; i < DS_Vai_tro.length; i++){
                        Chuoi_HTML_Danh_sach_Nhom_nguoi_dung += `<option value="">${DS_Vai_tro[i].Ten}</option>`
                    }
                    Chuoi_HTML_Danh_sach_Nhom_nguoi_dung += `</select>`

                    Th_Vai_tro.innerHTML = `<div><h5 style="color:red">Chọn nhóm người dùng: `+ Chuoi_HTML_Danh_sach_Nhom_nguoi_dung + `</h5></div>`
                   }
                  else {
                    Th_Quan_ly.innerHTML=""
                    Th_Danh_sach_Lop.innerHTML=""
                    Th_Danh_sach_Sinh_vien.innerHTML=""
                    Th_Sinh_vien = ""
                    Th_Chi_tiet_Sinh_vien.innerHTML=""
                    Th_Thong_bao.innerHTML=""
                    Th_Vai_tro.innerHTML=""
                  }
        }      
        function Xu_ly_chon_Sinh_vien(Ma_so){
            var Sinh_vien = Tim_Sinh_vien(Ma_so, Danh_sach_Sinh_vien)
            Th_Danh_sach_Sinh_vien.innerHTML = ""
            Th_Sinh_vien.innerHTML = Tao_Chuoi_HTML_Sinh_vien(Sinh_vien)
            Th_Chi_tiet_Sinh_vien.innerHTML =`<div class='alert' style='height:40px; float:left'><button class='btn btn-danger' onclick="Xu_ly_Chi_tiet_Sinh_vien('${Ma_so}')">Hồ sơ sinh viên</button></div><div class='alert' style='height:40px; float:left'><button class='btn btn-danger' onclick="Xu_ly_Qua_trinh_hoc_tap('${Ma_so}')">Quá trình học tập</button></div><div class='alert' style='height:40px; float:left'><button class='btn btn-danger' onclick="Xu_ly_Danh_sach_nghi_phep('${Ma_so}')">Nghỉ phép</button></div><div style='clear:both'></div>`
        }
        function Xu_ly_Chi_tiet_Sinh_vien(Ma_so){
            var Sinh_vien = Tim_Sinh_vien(Ma_so, Danh_sach_Sinh_vien)
            Th_Danh_sach_Sinh_vien.innerHTML = ""
            Th_Chi_tiet_Sinh_vien.innerHTML =`<div class='alert' style='height:40px; float:left'><button class='btn btn-danger' onclick="Xu_ly_Chi_tiet_Sinh_vien('${Ma_so}')">Hồ sơ sinh viên</button></div><div class='alert' style='height:40px; float:left'><button class='btn btn-danger' onclick="Xu_ly_Qua_trinh_hoc_tap('${Ma_so}')">Quá trình học tập</button></div><div class='alert' style='height:40px; float:left'><button class='btn btn-danger' onclick="Xu_ly_Danh_sach_nghi_phep('${Ma_so}')">Nghỉ phép</button></div><div style='clear:both'></div>`
            + Tao_Chuoi_HTML_Chi_tiet_Sinh_vien(Sinh_vien)
        }   
        function Xu_ly_Qua_trinh_hoc_tap(Ma_so){
            var Sinh_vien = Tim_Sinh_vien(Ma_so, Danh_sach_Sinh_vien)
            Th_Chi_tiet_Sinh_vien.innerHTML = `<div class='alert' style='height:40px; float:left'><button class='btn btn-danger' onclick="Xu_ly_Chi_tiet_Sinh_vien('${Ma_so}')">Hồ sơ sinh viên</button></div><div class='alert' style='height:40px; float:left'><button class='btn btn-danger' onclick="Xu_ly_Qua_trinh_hoc_tap('${Ma_so}')">Quá trình học tập</button></div><div class='alert' style='height:40px; float:left'><button class='btn btn-danger' onclick="Xu_ly_Danh_sach_nghi_phep('${Ma_so}')">Nghỉ phép</button></div><div style='clear:both'></div>`+Tao_Chuoi_HTML_Danh_sach_Diem(Sinh_vien)
        }   
        function Xu_ly_Danh_sach_nghi_phep(Ma_so){
            var Sinh_vien = Tim_Sinh_vien(Ma_so, Danh_sach_Sinh_vien)
            Th_Chi_tiet_Sinh_vien.innerHTML = `<div class='alert' style='height:40px; float:left'><button class='btn btn-danger' onclick="Xu_ly_Chi_tiet_Sinh_vien('${Ma_so}')">Hồ sơ sinh viên</button></div><div class='alert' style='height:40px; float:left'><button class='btn btn-danger' onclick="Xu_ly_Qua_trinh_hoc_tap('${Ma_so}')">Quá trình học tập</button></div><div class='alert' style='height:40px; float:left'><button class='btn btn-danger' onclick="Xu_ly_Danh_sach_nghi_phep('${Ma_so}')">Nghỉ phép</button></div><div style='clear:both'></div>`+Tao_Chuoi_HTML_Danh_sach_nghi_phep(Sinh_vien)
        }
        function Xu_ly_Duyet_nghi_phep(Ma_so_Sinh_vien, Ma_so_Don_nghi_phep){
            var Sinh_vien = Tim_Sinh_vien(Ma_so_Sinh_vien, Danh_sach_Sinh_vien)
            var Don_nghi_phep = Tim_Don_nghi_phep(Sinh_vien, Ma_so_Don_nghi_phep) 
            Don_nghi_phep.Y_kien.Ngay = new Date()
            Don_nghi_phep.Y_kien.Da_co_Y_kien = true
            Don_nghi_phep.Y_kien.Noi_dung = document.getElementById('Noi_dung_phe_duyet').value
            var kiem_tra_hop_le = Don_nghi_phep.Y_kien.Noi_dung != ""
            if (kiem_tra_hop_le == true){         
                Ghi_Don_nghi_phep(Sinh_vien)
                alert("Đã phê duyệt")
                document.getElementById(Ma_so_Sinh_vien+"_"+Ma_so_Don_nghi_phep).outerHTML = ""
            }
            else {
                alert("Cần cho ý kiến")
            }    
        }   
        function Xu_ly_Khong_Duyet_nghi_phep(Ma_so_Sinh_vien, Ma_so_Don_nghi_phep){
            var Sinh_vien = Tim_Sinh_vien(Ma_so_Sinh_vien, Danh_sach_Sinh_vien)
            var Don_nghi_phep = Tim_Don_nghi_phep(Sinh_vien, Ma_so_Don_nghi_phep)
            Don_nghi_phep.Y_kien.Ngay = new Date()
            Don_nghi_phep.Y_kien.Da_co_Y_kien = true
            Don_nghi_phep.Y_kien.Noi_dung ="Không duyệt"                     
            Ghi_Don_nghi_phep(Sinh_vien)
            alert("Đã ghi nhận không đồng ý")  
            document.getElementById(Ma_so_Sinh_vien+"_"+Ma_so_Don_nghi_phep).outerHTML = ""      
        }     
        function Xu_ly_Dang_xuat(){
            window.location.href ="../../../1581218_1_Phan_he_khach_tham_quan_JS/Ung_dung/1_Giao_dien/MH_Chinh.html"              
        }
        $(document).ready(function(){ 
        //Tự động click
        if (GetURLParameter('Th_Ten_dang_nhap') != 0 && GetURLParameter('Th_Mat_khau') != 0){
        document.getElementById('Dong_y').click();
        }
        });
        </script>       
</body>

</html>








